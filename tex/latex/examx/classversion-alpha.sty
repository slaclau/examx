\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{classversion-alpha}[2022/02/03 v0.01 Used for 
versioning classes]
\RequirePackage{xparse}
\RequirePackage{pgf}
\RequirePackage{readprov}
\RequirePackage{alphalph}
\RequirePackage{ifthen}

\providecommand*{\file}[1]{\texttt {#1}}
\providecommand*{\Lpack}[1]{\textsf {#1}}

\def\classname#1{\gdef\@classname{#1} \title{Installation check and 
release information for 
\Lpack{\@classname} class \classversion@currentRelease}}

\newcounter{classversion@file}
\setcounter{classversion@file}{0}
\newcounter{classversion@release}
\setcounter{classversion@release}{0}

\newcounter{classversion@int}
\newcounter{classversion@iint}

\ExplSyntaxOn

\NewDocumentCommand{\NewRelease}{m}{
    \gdef\classversion@currentRelease{#1}
    
    \stepcounter{classversion@release}
    
    \cs_new:cpx 
    {release\alphalph{\theclassversion@release}} {#1}
    
    \setcounter{classversion@file}{0}
    
%    
%\newcounter{classversion@filesinrelease\alphalph{\theclassversion@release}}
}

\NewDocumentCommand{\thisreleasenumber}{m}
    {\csname release\alphalph{#1}\endcsname}

\cs_set:Npn \classversion_filesinthisrelease:n #1
    {\value{classversion@filesinrelease\alphalph{#1}}
%\def\test{\classversion@filesinthisrelease{1}}

\NewDocumentCommand{\IncludeFileInRelease}{m m}{
    \stepcounter{classversion@file}
    
    \ReadFileInfos{#1}
    
    \cs_new:cpx 
    {file\alphalph{\theclassversion@file}} {#1}
    
    \cs_new:cpx {version\alphalph{\theclassversion@file}}  
    {\ignorespaces\UseVersionOf{#1}\ignorespaces}
    
    \cs_new:cpx {eversion\alphalph{\theclassversion@file}} 
    {\ignorespaces#2\ignorespaces}
    
    \cs_new:cpx {date\alphalph{\theclassversion@file}} {\UseDateOf{#1}}
    
    \cs_new:cpx 
    {file\AlphAlph{\theclassversion@release}\alphalph{\theclassversion@file}}
     {#1}
    
    \cs_new:cpx 
    {version\AlphAlph{\theclassversion@release}\alphalph{\theclassversion@file}}
    {\ignorespaces\UseVersionOf{#1}\ignorespaces}
    
    \cs_new:cpx 
    {eversion\AlphAlph{\theclassversion@release}\alphalph{\theclassversion@file}}
    {\ignorespaces#2\ignorespaces}
    
    \cs_new:cpx 
    {date\AlphAlph{\theclassversion@release}\alphalph{\theclassversion@file}}
     {\UseDateOf{#1}}
    
%    
%\stepcounter{classversion@filesinrelease\alphalph{\theclassversion@release}}
}
\ExplSyntaxOff

\NewDocumentCommand{\NumberOfFilesInRelease}{}{\theclassversion@file}

\NewDocumentCommand{\installation}{O{Installation check}}{
    \section*{#1}
    This installation of \textsf{\@classname} 
    consists of the following \NumberOfFilesInRelease\space files:
    \begingroup
    \setcounter{classversion@int}{0}
    \begin{enumerate}
    \loop
        \item
        \stepcounter{classversion@int}
        \edef\tempa{\csname 
        version\alphalph{\theclassversion@int}\endcsname}
        \edef\tempb{\csname 
        eversion\alphalph{\theclassversion@int}\endcsname}
        \file{\csname 
        file\alphalph{\theclassversion@int}\endcsname}~\csname 
        version\alphalph{\theclassversion@int}\endcsname, dated 
        \csname date\alphalph{\theclassversion@int}\endcsname
       
        {\color{red}(expecting \tempb)}
    \ifnum\theclassversion@int<\NumberOfFilesInRelease    
    \repeat
    \end{enumerate}
    \endgroup
}
\NewDocumentCommand{\latestrelease}{O{Release manifest}}{
    \section*{#1}
    This release (\classversion@currentRelease) of \Lpack{\@classname} 
    consists of the following \NumberOfFilesInRelease\space files:
    \begingroup
    \setcounter{classversion@int}{0}
    \begin{enumerate}
        \loop
            \item
            \stepcounter{classversion@int}
            \file{\csname 
            file\alphalph{\theclassversion@int}\endcsname}~\csname 
            eversion\alphalph{\theclassversion@int}\endcsname
        \ifnum\theclassversion@int<\NumberOfFilesInRelease 
        \repeat
    \end{enumerate}
    \endgroup
}
\NewDocumentCommand{\thisrelease}{O{Release \thisreleasenumber{#2}} m}{
    \section*{#1}
    \begingroup
    \setcounter{classversion@int}{0}
    \begin{enumerate}
        \loop
        \item
        \stepcounter{classversion@int}
        \file{\csname         
        file\AlphAlph{#2}\alphalph{\theclassversion@int}\endcsname}~\csname
         eversion\AlphAlph{#2}\alphalph{\theclassversion@int}\endcsname
        \ifnum\theclassversion@int<\NumberOfFilesInRelease
        \repeat
    \end{enumerate}
    \endgroup
}

\NewDocumentCommand{\releasehistory}{}{
    \begingroup
    \setcounter{classversion@iint}{0}
    \loop
        \stepcounter{classversion@iint}
        \thisrelease{\theclassversion@iint}
    \ifnum\theclassversion@iint<\theclassversion@release
    \repeat
    \endgroup
}